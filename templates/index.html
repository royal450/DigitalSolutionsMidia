<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to MP3</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #1e1e2f; color: white; font-family: 'Poppins', sans-serif; text-align: center; padding-top: 50px; }
        .container-box { background: rgba(255, 255, 255, 0.05); border-radius: 20px; padding: 30px; width: 450px; margin: auto; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .progress-container { background: rgba(255, 255, 255, 0.1); height: 12px; border-radius: 10px; overflow: hidden; margin-top: 20px; }
        .progress-bar { background: linear-gradient(45deg, #ff416c, #ff4b2b); height: 100%; width: 0%; border-radius: 10px; transition: width 0.5s ease; }
        .btn-custom { background: linear-gradient(45deg, #ff416c, #ff4b2b); color: white; font-weight: bold; border: none; padding: 12px 25px; border-radius: 50px; cursor: pointer; width: 100%; }
        .branding { margin-top: 30px; font-size: 14px; color: #bbb; }
        .file-upload-label { display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }
        .play-btn, .download-btn { display: none; margin-top: 15px; }
        .extracted-text { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left; max-height: 200px; overflow-y: auto; display: none; }
    </style>
</head>
<body>
    <div class="container-box">
        <h3>PDF to MP3</h3>
        <input type="file" id="fileUpload" accept=".pdf" hidden>
        <label for="fileUpload" class="btn-custom file-upload-label"><i class="fas fa-cloud-upload-alt"></i> Upload PDF</label>
        <div class="progress-container"><div class="progress-bar"></div></div>
        <div class="status-box">Waiting for file...</div>
        <div class="extracted-text" id="extractedText"><strong>Extracted Text:</strong><p id="textContent"></p></div>
        <button class="btn-custom play-btn"><i class="fas fa-play"></i> Play Audio</button>
        <button class="btn-custom download-btn"><i class="fas fa-download"></i> Download MP3</button>
    </div>
    <div class="branding">Crafted with ❤️ by <strong>Royal Developer</strong></div>

    <script>
        const fileInput = document.getElementById("fileUpload");
        const progressBar = document.querySelector(".progress-bar");
        const statusBox = document.querySelector(".status-box");
        const playButton = document.querySelector(".play-btn");
        const downloadButton = document.querySelector(".download-btn");
        const extractedTextDiv = document.getElementById("extractedText");
        const textContent = document.getElementById("textContent");
        let audio = null;

        fileInput.addEventListener("change", async function() {
            if (fileInput.files.length > 0) {
                // ✅ Reset UI (purana text, buttons reset)
                progressBar.style.width = "0%";
                statusBox.textContent = "Uploading PDF...";
                extractedTextDiv.style.display = "none";
                playButton.style.display = "none";
                downloadButton.style.display = "none";
                textContent.textContent = "";

                let formData = new FormData();
                formData.append("file", fileInput.files[0]);

                let response = await fetch("/upload", { method: "POST", body: formData });
                let data = await response.json();

                if (data.mp3_file && data.text) {
                    progressBar.style.width = "100%";
                    statusBox.textContent = "Conversion Complete!";
                    playButton.style.display = "block";
                    downloadButton.style.display = "block";
                    extractedTextDiv.style.display = "block";
                    textContent.textContent = data.text;
                    audio = new Audio(`/output/${data.mp3_file}`);
                } else {
                    statusBox.textContent = "Error: " + data.error;
                }
            }
        });

        playButton.addEventListener("click", function() {
            if (audio) {
                if (audio.paused) {
                    audio.play();
                    playButton.innerHTML = '<i class="fas fa-stop"></i> Stop Audio';
                } else {
                    audio.pause();
                    playButton.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                }
            }
        });

        downloadButton.addEventListener("click", function() {
            if (audio) {
                window.location.href = `/output/${audio.src.split("/").pop()}`;
            }
        });
    </script>
</body>
        </html>
